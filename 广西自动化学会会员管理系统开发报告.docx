# 广西自动化学会会员管理系统开发报告

## 1. 项目概述

### 1.1 项目背景
广西自动化学会作为一个学术组织，需要对会员进行有效的管理。传统的人工管理方式效率低下，容易出错，且难以满足会员查询信息、申请入会等需求。因此，开发一个现代化的会员管理系统势在必行。

### 1.2 项目目标
研制一个满足广西自动化学会会员管理要求的小型软件系统V1.0，并投入使用，方便对会员网上信息进行管理。

### 1.3 项目功能
1. **用户登录与注册**：支持会员和管理员账号登录，会员可以在线注册
2. **会员管理**：会员可填写个人信息，查询缴费信息和身份级别
3. **会员申请**：通过邮件功能申请会员
4. **管理员功能**：查看会员资料、授予级别、导出Excel、发送邮件提醒
5. **权限管理**：不同角色拥有不同权限

## 2. 技术栈

### 2.1 前端技术
- **框架**：React 19.2.0
- **语言**：TypeScript
- **构建工具**：Vite 7.2.4
- **UI框架**：Tailwind CSS 4.1.18
- **路由管理**：React Router 7.11.0

### 2.2 后端技术
- **数据库**：Supabase (PostgreSQL)
- **认证服务**：Supabase Auth
- **API**：Supabase REST API

### 2.3 其他工具
- **版本控制**：Git
- **部署平台**：GitHub Pages
- **移动打包**：APK包装

## 3. 系统设计

### 3.1 系统架构

```
┌───────────────────────────────────────────────────────────┐
│                      前端应用层                           │
│  React + TypeScript + Tailwind CSS + Vite                 │
├───────────────────────────────────────────────────────────┤
│                      中间件层                             │
│  Supabase Auth + Supabase REST API                       │
├───────────────────────────────────────────────────────────┤
│                      数据存储层                           │
│  PostgreSQL Database (Supabase)                          │
└───────────────────────────────────────────────────────────┘
```

### 3.2 数据库设计

**profiles表**：
| 字段名 | 数据类型 | 描述 |
|-------|---------|------|
| id | uuid | 主键，关联auth.users |
| email | text | 邮箱，唯一 |
| full_name | text | 姓名 |
| role | text | 角色（member/admin） |
| membership_level | text | 会员级别 |
| membership_status | text | 会员状态 |
| payment_status | text | 缴费状态 |
| join_date | date | 加入日期 |
| phone | text | 电话 |
| institution | text | 所属机构 |
| created_at | timestamptz | 创建时间 |

**applications表**：
| 字段名 | 数据类型 | 描述 |
|-------|---------|------|
| id | uuid | 主键 |
| user_id | uuid | 关联profiles.id |
| full_name | text | 姓名 |
| content | jsonb | 申请内容 |
| status | text | 申请状态 |
| created_at | timestamptz | 创建时间 |

### 3.3 系统流程

#### 3.3.1 登录流程

```
开始 → 输入邮箱密码 → 提交登录 → 验证凭证 → 检查用户角色 → 跳转对应仪表盘 → 结束
     ↓                                 ↑
     └─────────────────────────────────┘
               验证失败
```

#### 3.3.2 会员注册流程

```
开始 → 填写注册信息 → 提交注册 → 发送验证邮件 → 用户验证 → 创建会员资料 → 结束
     ↓                                 ↑
     └─────────────────────────────────┘
               注册失败
```

## 4. 核心功能实现

### 4.1 认证系统

**AuthContext.tsx** - 管理用户认证状态

```typescript
import { createContext, useContext, useState, useEffect } from 'react';
import { supabase } from '../lib/supabase';
import type { User } from '@supabase/supabase-js';

interface AuthContextType {
  user: User | null;
  profile: any;
  isLoading: boolean;
  signIn: (email: string, password: string) => Promise<void>;
  signOut: () => Promise<void>;
}

const AuthContext = createContext<AuthContextType | undefined>(undefined);

export const AuthProvider: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const [user, setUser] = useState<User | null>(null);
  const [profile, setProfile] = useState<any>(null);
  const [isLoading, setIsLoading] = useState(true);

  useEffect(() => {
    // 监听认证状态变化
    const { data: authListener } = supabase.auth.onAuthStateChange(
      async (event, session) => {
        setUser(session?.user ?? null);
        if (session?.user) {
          // 获取用户资料
          const { data } = await supabase
            .from('profiles')
            .select('*')
            .eq('id', session.user.id)
            .single();
          setProfile(data);
        } else {
          setProfile(null);
        }
        setIsLoading(false);
      }
    );

    return () => authListener.subscription.unsubscribe();
  }, []);

  const signIn = async (email: string, password: string) => {
    await supabase.auth.signInWithPassword({ email, password });
  };

  const signOut = async () => {
    await supabase.auth.signOut();
  };

  return (
    <AuthContext.Provider value={{ user, profile, isLoading, signIn, signOut }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => {
  const context = useContext(AuthContext);
  if (context === undefined) {
    throw new Error('useAuth must be used within an AuthProvider');
  }
  return context;
};
```

### 4.2 路由保护

**ProtectedRoute.tsx** - 基于角色的路由保护

```typescript
import { Navigate, Outlet } from 'react-router-dom';
import { useAuth } from '../context/AuthContext';

interface ProtectedRouteProps {
  role: 'member' | 'admin';
}

const ProtectedRoute: React.FC<ProtectedRouteProps> = ({ role }) => {
  const { user, profile, isLoading } = useAuth();

  if (isLoading) {
    return <div className="flex justify-center items-center h-screen">加载中...</div>;
  }

  if (!user || !profile) {
    return <Navigate to="/login" replace />;
  }

  // 管理员可以访问所有受保护路由
  if (role === 'admin' && profile.role !== 'admin') {
    return <Navigate to="/member" replace />;
  }

  // 会员只能访问会员路由
  if (role === 'member' && profile.role === 'admin') {
    return <Navigate to="/admin" replace />;
  }

  return <Outlet />;
};

export default ProtectedRoute;
```

### 4.3 管理员功能

**AdminDashboard.tsx** - 管理员仪表盘核心功能

```typescript
// 导出会员数据到Excel
const exportToExcel = async () => {
  try {
    const { data: members } = await supabase
      .from('profiles')
      .select('*')
      .order('created_at', { ascending: false });

    if (members) {
      // 使用xlsx库创建Excel文件
      const worksheet = XLSX.utils.json_to_sheet(members);
      const workbook = XLSX.utils.book_new();
      XLSX.utils.book_append_sheet(workbook, worksheet, 'Members');
      XLSX.writeFile(workbook, `members_${new Date().toISOString().split('T')[0]}.xlsx`);
    }
  } catch (error) {
    console.error('Error exporting members:', error);
    setError('导出会员数据失败');
  }
};

// 授予会员级别
const updateMembershipLevel = async (memberId: string, level: string) => {
  try {
    await supabase
      .from('profiles')
      .update({ membership_level: level })
      .eq('id', memberId);
    setSuccess('会员级别更新成功');
    fetchMembers(); // 刷新会员列表
  } catch (error) {
    console.error('Error updating membership level:', error);
    setError('更新会员级别失败');
  }
};
```

## 5. 界面设计

### 5.1 登录页面
- 简洁的登录表单
- 支持会员注册和忘记密码
- 响应式设计，适配移动端

### 5.2 会员仪表盘
- 个人信息展示
- 缴费状态查询
- 会员申请入口
- 消息中心

### 5.3 管理员仪表盘
- 会员列表管理
- 会员级别授予
- Excel导出功能
- 邮件发送功能

## 6. 测试与调试

### 6.1 功能测试

| 测试功能 | 测试结果 |
|---------|---------|
| 会员注册 | 通过 |
| 会员登录 | 通过 |
| 管理员登录 | 通过 |
| 个人信息修改 | 通过 |
| 会员级别查询 | 通过 |
| 会员申请提交 | 通过 |
| 管理员审核 | 通过 |
| Excel导出 | 通过 |

### 6.2 调试过程

1. **问题**：部署后Supabase连接失败
   **解决方案**：检查GitHub Secrets配置，确保环境变量正确注入

2. **问题**：移动端适配问题
   **解决方案**：使用Tailwind CSS的响应式类，优化移动端布局

3. **问题**：会员申请状态更新不及时
   **解决方案**：添加实时数据监听，使用Supabase的realtime功能

## 7. 系统使用说明

### 7.1 会员使用指南

1. **注册与登录**
   - 访问系统首页，点击"还没有账号？去注册"
   - 填写邮箱、密码等信息，完成注册
   - 使用注册邮箱和密码登录系统

2. **完善个人信息**
   - 登录后进入会员仪表盘
   - 点击"个人信息"，填写详细资料
   - 保存后等待管理员审核

3. **查询缴费信息**
   - 在会员仪表盘查看"缴费状态"
   - 点击"缴费记录"查看历年缴费情况

4. **申请会员**
   - 点击"会员申请"，填写申请表格
   - 提交后等待管理员审核
   - 可在"申请状态"查看审核进度

### 7.2 管理员使用指南

1. **登录系统**
   - 使用管理员账号登录系统
   - 自动跳转至管理员仪表盘

2. **管理会员信息**
   - 在"会员管理"查看所有会员列表
   - 点击会员姓名查看详细信息
   - 可修改会员级别、状态等信息

3. **审核会员申请**
   - 在"申请管理"查看待审核申请
   - 查看申请详情，点击"通过"或"拒绝"
   - 审核结果将通过邮件通知会员

4. **导出会员数据**
   - 在"会员管理"点击"导出Excel"
   - 系统将生成并下载会员数据Excel文件

5. **发送邮件通知**
   - 在"消息中心"点击"发送邮件"
   - 选择接收会员，填写邮件内容
   - 点击"发送"即可发送通知

## 8. 项目总结与展望

### 8.1 项目总结

本项目成功实现了广西自动化学会会员管理系统的核心功能，包括：
- 完整的用户认证系统
- 会员信息管理
- 会员申请审核流程
- 管理员权限控制
- Excel数据导出
- 邮件通知功能

系统采用了现代化的技术栈，具有良好的可扩展性和维护性。界面设计简洁友好，操作流程清晰，适合不同年龄段的用户使用。

### 8.2 项目展望

1. **功能扩展**
   - 添加会员活动管理功能
   - 实现在线缴费功能
   - 增加会员积分系统

2. **性能优化**
   - 优化数据库查询性能
   - 实现前端缓存策略
   - 提高系统响应速度

3. **安全性增强**
   - 加强密码复杂度要求
   - 实现多因素认证
   - 定期进行安全审计

4. **用户体验改进**
   - 增加系统使用引导
   - 优化移动端体验
   - 添加更多个性化设置

## 9. 参考文献

[1] 李康乐. Visual C#.Net程序设计实用教程[S]. 北京：清华大学出版社，2014
[2] 董付国. Python程序设计开发宝典[S]. 北京：清华大学出版社，2017
[3] 莫振杰. HTML+CSS+JavaScript快速入门[S]. 北京：人民邮电出版社，2020
[4] React官方文档. https://react.dev/
[5] TypeScript官方文档. https://www.typescriptlang.org/
[6] Supabase官方文档. https://supabase.com/docs
[7] Tailwind CSS官方文档. https://tailwindcss.com/docs

## 10. 附录

### 10.1 主要源代码文件

| 文件名 | 功能描述 |
|-------|---------|
| App.tsx | 应用入口和路由配置 |
| AuthContext.tsx | 认证状态管理 |
| ProtectedRoute.tsx | 路由保护 |
| Login.tsx | 登录页面 |
| Register.tsx | 注册页面 |
| MemberDashboard.tsx | 会员仪表盘 |
| AdminDashboard.tsx | 管理员仪表盘 |
| supabase.ts | Supabase配置 |

### 10.2 数据库脚本

- db_schema.sql：数据库表结构定义
- db_triggers.sql：数据库触发器
- db_new_features.sql：新功能数据库脚本

### 10.3 部署说明

1. **环境要求**
   - Node.js 18+ 
   - npm 9+ 

2. **本地开发**
   ```bash
   # 安装依赖
   npm install
   
   # 启动开发服务器
   npm run dev
   ```

3. **构建与部署**
   ```bash
   # 构建生产版本
   npm run build
   
   # 部署到GitHub Pages
   # 通过GitHub Actions自动部署
   ```

4. **移动端打包**
   - 使用Capacitor或其他工具将Web应用包装为APK
   - 配置应用图标和启动页
   - 生成签名APK文件

---

**报告撰写人**：大一学生
**完成日期**：2026年1月3日
**指导教师**：[指导教师姓名]
