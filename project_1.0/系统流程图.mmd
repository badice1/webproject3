graph TD
    A[用户访问系统] --> B[登录页面]
    B --> C{选择操作}
    
    C -->|登录| D[输入邮箱密码]
    C -->|注册| E[注册页面]
    C -->|忘记密码| F[忘记密码页面]
    
    E --> G[填写注册信息]
    G --> H[提交注册]
    H --> I[发送验证邮件]
    I --> J[注册成功]
    J --> B
    
    F --> K[输入注册邮箱]
    K --> L[发送重置链接]
    L --> M[重置密码成功]
    M --> B
    
    D --> N[验证凭证]
    N -->|验证失败| O[显示错误信息]
    O --> B
    
    N -->|验证成功| P{判断角色}
    P -->|会员| Q[会员仪表盘]
    P -->|管理员| R[管理员仪表盘]
    
    %% 会员功能流程
    Q --> S[查看个人信息]
    Q --> T[查询缴费情况]
    Q --> U[申请会员]
    Q --> V[查看通知]
    
    U --> W[填写申请表格]
    W --> X[提交申请]
    X --> Y[等待审核]
    Y --> Z[审核结果通知]
    
    %% 管理员功能流程
    R --> AA[查看会员列表]
    R --> AB[审核会员申请]
    R --> AC[导出Excel]
    R --> AD[发送邮件通知]
    
    AA --> AE[编辑会员信息]
    AA --> AF[修改会员级别]
    
    AB --> AG{审核结果}
    AG -->|通过| AH[更新会员状态]
    AG -->|拒绝| AI[发送拒绝通知]
    
    AH --> AJ[发送通过通知]
    
    %% 数据流向
    D --> AK[Supabase认证]
    AK --> AL[获取用户信息]
    AL --> AM[查询profiles表]
    AM --> P
    
    U --> AN[插入applications表]
    AB --> AO[查询applications表]
    AG --> AP[更新applications表]
    
    AC --> AQ[生成Excel文件]
    AQ --> AR[下载文件]
    
    AD --> AS[调用邮件服务]
    AS --> AT[发送邮件]
    
    %% 样式设置
    classDef page fill:#f0f8ff,stroke:#333,stroke-width:2px;
    classDef action fill:#e6f7ff,stroke:#333,stroke-width:2px;
    classDef decision fill:#fff7e6,stroke:#333,stroke-width:2px;
    classDef database fill:#f6ffed,stroke:#333,stroke-width:2px;
    
    class B,E,F,Q,R page;
    class C,P,AG decision;
    class AK,AL,AM,AN,AO,AP database;
    class A,D,G,H,I,J,K,L,M,N,O,S,T,U,V,W,X,Y,Z,AA,AB,AC,AD,AE,AF,AJ,AI,AQ,AR,AS,AT action;