# 会员剩余时长功能实现说明

## 一、功能概述
为会员系统添加了"会员剩余时长"字段，管理员可以在管理员仪表盘中查看和修改每个会员的剩余会员时长。

## 二、实现内容

### 1. 数据库修改
- 创建了 `add_membership_duration.sql` 脚本，用于在 `profiles` 表中添加 `membership_duration_days` 字段
- 字段类型：`INTEGER`
- 默认值：`0`
- 表示：会员剩余有效天数

### 2. TypeScript 类型定义
- 更新了 `src/types/index.ts` 中的 `Profile` 接口
- 添加了 `membership_duration_days?: number` 字段

### 3. 前端功能实现
修改了 `AdminDashboard.tsx` 组件：

#### 3.1 编辑功能增强
- 在 `startEdit` 函数中，初始化编辑表单时包含 `membership_duration_days` 字段
- 默认值为 `0`，避免空值问题

#### 3.2 表格显示增强
- 添加了"剩余时长"列到会员列表表格
- 非编辑状态下显示：`{member.membership_duration_days || 0} 天`
- 编辑状态下显示：数字输入框，允许修改剩余天数

#### 3.3 导出功能增强
- 在 `handleExport` 函数中，将会员剩余时长字段添加到导出的 Excel 数据中
- 导出列名："剩余时长"

## 三、使用说明

### 1. 数据库部署
1. 登录 Supabase 控制台
2. 进入 SQL 编辑器
3. 复制并执行 `add_membership_duration.sql` 脚本
4. 等待脚本执行完成

### 2. 前端使用
1. 管理员登录系统，进入管理员仪表盘
2. 在会员列表中，找到需要修改剩余时长的会员
3. 点击"编辑"按钮（铅笔图标）
4. 在编辑状态下，找到"剩余时长"输入框，输入新的天数
5. 点击"保存"按钮（对勾图标）完成修改
6. 可以通过导出 Excel 功能，查看所有会员的剩余时长

## 四、注意事项
1. 剩余时长以"天"为单位
2. 输入值必须为非负整数
3. 初始值为 0，表示会员没有剩余时长
4. 该字段可以结合会员状态使用，例如：
   - 当剩余时长 > 0 时，会员状态为 "active"
   - 当剩余时长 ≤ 0 时，会员状态为 "inactive"

## 五、后续扩展建议
1. 可以添加自动更新剩余时长的定时任务
2. 可以添加剩余时长不足时的自动提醒功能
3. 可以添加剩余时长与会员等级关联的规则
4. 可以添加续费功能，允许管理员或会员自己续费延长时长